# Обновление методологической таблицы с показателями

## 🎯 Что было реализовано

Добавлена поддержка отображения **основных и лабораторных показателей** в методологической таблице сортоиспытаний.

## 📊 Новая структура данных

### API `/api/annual-reports/methodology_table/`

Каждый сорт теперь содержит:

```typescript
interface SortData {
  // ... существующие поля
  main_indicators: Record<string, IndicatorValue>;
  quality_indicators: Record<string, IndicatorValue>;
}

interface IndicatorValue {
  value: number;
  unit: string;
  name: string;
  description?: string;
}
```

### Основные показатели (main_indicators)
- **Урожайность** (`yield`) - ц/га
- **Высота растений** (`plant_height`) - см
- **Вегетационный период** (`vegetation_period`) - дней
- **Масса 1000 зёрен** (`thousand_seed_weight`) - г
- **Полнота всходов** (`emergence_completeness`) - %
- **Продуктивная кустистость** (`tillering`) - шт.
- **Устойчивость к полеганию** (`lodging_resistance`) - балл (1-9)
- **Устойчивость к засухе** (`drought_resistance`) - балл (1-9)
- **Выход зерна** (`grain_output`) - %

### Лабораторные показатели (quality_indicators)
- **Содержание белка** (`protein_content`) - %
- **Содержание клейковины** (`gluten_content`) - %
- **Натура зерна** (`grain_nature`) - г/л
- **Стекловидность** (`vitreousness`) - %

## 🎨 Обновления UI

### 1. Компонент `MethodologyTable`
- Добавлена кнопка "Показатели" в каждой строке сорта
- Реализовано раскрывающееся отображение показателей
- **НОВОЕ:** Переключение между основными и лабораторными показателями через вкладки

### 2. Компонент `IndicatorsDisplay` (обновлен)
- **Вкладки** для переключения между типами показателей
- **Карточки** для каждого показателя с описаниями
- **Иконки** для визуального разделения типов показателей
- **Адаптивный дизайн** для мобильных устройств
- **Интерактивность** - плавное переключение между вкладками

### 3. Обновленные типы
- Добавлен интерфейс `IndicatorValue`
- Обновлен интерфейс `SortData` с новыми полями
- Полная типизация для TypeScript

## 🧪 Тестирование

Создан тестовый компонент `IndicatorsTest` с примером данных:

```typescript
// Пример данных с показателями
const testData: MethodologyTableResponse = {
  // ... основная структура
  methodology_table: {
    "Алматинский регион": {
      "Раннеспелая группа": {
        sorts: [
          {
            sort_name: "Патриция",
            main_indicators: {
              "plant_height": { value: 51.0, unit: "см", name: "Высота растений" },
              "yield": { value: 9.2, unit: "ц/га", name: "Урожайность" },
              // ... другие показатели
            },
            quality_indicators: {
              "protein_content": { value: 14.5, unit: "%", name: "Содержание белка" },
              // ... другие показатели
            }
          }
        ]
      }
    }
  }
};
```

## 🚀 Как использовать

### 1. Просмотр показателей
1. Откройте методологическую таблицу
2. Найдите нужный сорт
3. Нажмите кнопку "Показатели" в строке сорта
4. **Переключайтесь между вкладками:**
   - 📊 **Основные показатели** - полевые данные
   - 🧪 **Лабораторные показатели** - качественные характеристики
5. Просматривайте детальную информацию с описаниями

### 2. Тестирование
```bash
# Перейдите на тестовую страницу
/methodology/test
```

## 🎨 Новый дизайн с встроенными колонками

### Структура отображения:
```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ Регион: Алматинский регион                                    [▼] 2 групп спелости    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ Группа: Раннеспелая (EARLY)                              [▼] Стандарт: Патриция        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ Сорт | Лет | 2023 | 2024 | 2025 | Средняя | Отклонение | Высота | Период | Белок | Статус │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ Патриция | 3 | 8.5 | 9.1 | 9.2 | 8.9 | +12.2% | 51 см | 80 дн | 14.5% | Ожидает │
│ Стандарт | 3 | 7.8 | 8.2 | 8.1 | 8.0 | 0% | 48 см | 85 дн | 13.2% | Одобрено │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Преимущества нового дизайна:
- ✅ **Компактность** - все показатели видны сразу в одной таблице
- ✅ **Сравнение** - легко сравнивать показатели между сортами
- ✅ **Сворачивание** - можно скрывать/показывать регионы и группы спелости
- ✅ **Визуальное разделение** - основные и лабораторные показатели в разных колонках
- ✅ **Интерактивность** - плавное сворачивание/разворачивание секций
- ✅ **Адаптивность** - корректное отображение на всех устройствах

## 📁 Файлы изменений

### Новые файлы:
- `src/components/methodology/IndicatorsTest.tsx` - тестовый компонент
- `src/pages/Methodology/MethodologyTest.tsx` - тестовая страница
- `METHODOLOGY_INDICATORS_UPDATE.md` - документация

### Обновленные файлы:
- `src/types/methodology.types.ts` - добавлены типы для показателей
- `src/components/methodology/MethodologyTable.tsx` - обновлен для показа показателей
- `src/components/methodology/index.ts` - экспорт новых компонентов
- `src/pages/Methodology/index.ts` - экспорт тестовой страницы

## ✅ Результат

Теперь методологическая таблица поддерживает:
- ✅ Отображение основных показателей за текущий год
- ✅ Отображение лабораторных показателей за текущий год  
- ✅ Интерактивное раскрытие/скрытие показателей
- ✅ Красивое оформление с иконками и цветами
- ✅ Адаптивный дизайн
- ✅ Полная типизация TypeScript
- ✅ Тестовые данные для проверки

## 🔄 Следующие шаги

1. Интеграция с реальным API
2. Добавление фильтрации показателей
3. Экспорт показателей в Excel/PDF
4. Сравнение показателей между сортами
5. Графическое представление показателей
